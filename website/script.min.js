const oversize_shelf_heights=new Uint16Array([1940,1939,1940,1939,1940,1939,2397]),layout={zoom_out_bounds_rect:void 0,total_stacks:9,stack_y_spacer:2909,zone_highlight_offset:970,standard:{x:0,stack_width:62400,stack_height:14033,bank_width:5200,uniform_bank_width:5200,height:14033,shelf_heights:new Uint16Array([1455,1454,1455,1454,1455,1454,1455,1454,1198,1199]),multiple_shelf_heights:{3:{6:new Uint16Array([1445,979,951,959,1484,1455,1454,1455,1454,1198,1199]),9:new Uint16Array([1461,1009,1140,1126,1137,1455,1454,1455,1454,1198,1199])},4:{5:new Uint16Array([1455,1454,1455,1454,1498,1735,1632,1591,1778])},6:{1:oversize_shelf_heights,2:oversize_shelf_heights,3:oversize_shelf_heights,4:oversize_shelf_heights,5:oversize_shelf_heights,6:oversize_shelf_heights}}},stack_one:{x:5200,stack_height:14033,stack_width:52e3,uniform_bank_width:5200,shelf_heights:new Uint16Array([1455,1454,1455,1454,1455,1454,1455,1454,1198,1199])},ephemera:{x:7800,stack_width:46720,stack_height:14033,shelf_heights:new Uint16Array([1455,1454,1455,1454,1455,1454,1455,1239,1360,1361]),bank_widths:new Uint16Array([5200,5200,5200,5200,3880,3880,3880,3880,5200,5200]),narrow_width:3880},therkelson:{x:23508,stack_width:15424,stack_height:7907,bank_width:3846,uniform_bank_width:3846,shelf_heights:new Uint16Array([1354,1354,1354,1354,1245,1246]),bank_widths:new Uint16Array([3846,3846,3846,3846])},flat_file:{x:26921,stack_width:8558,stack_height:5416,bank_widths:new Uint16Array([4972,3586]),shelf_heights:new Uint16Array([5416,5416])}};var stacks_data,zones_data,periodicals_data,sc_data,ia_data,ui_vars={menu_open:!0,list_view:!1,resize_handle_current_x:0,resize_handle_new_x:0,resize_handle_current_y:0,resize_handle_new_y:0,vertical_breakpoint:640,vertical_mode:!1};function addWindowResizeEventListeners(){window.innerWidth<=ui_vars.vertical_breakpoint&&(ui_vars.vertical_mode=!0),0==ui_vars.vertical_mode?(gid("resize-handle").style.display="block",gid("resize-handle-vertical").style.display="none"):(gid("resize-handle").style.display="none",gid("resize-handle-vertical").style.display="block"),window.addEventListener("resize",(function(){const e=gid("menu-container");window.innerWidth<=ui_vars.vertical_breakpoint&&0==ui_vars.vertical_mode?(ui_vars.vertical_mode=!0,e.style.width=null,e.style.height=gid("resize-handle-vertical").style.bottom,r_handle_reset(),gid("resize-handle").style.display="none",0==ui_vars.menu_open?gid("resize-handle-vertical").style.display="none":gid("resize-handle-vertical").style.display="block"):window.innerWidth>ui_vars.vertical_breakpoint&&1==ui_vars.vertical_mode&&(ui_vars.vertical_mode=!1,e.style.top=null,e.style.height="100%",e.style.width=gid("resize-handle").style.left,r_handle_reset(),gid("resize-handle-vertical").style.display="none",0==ui_vars.menu_open?gid("resize-handle").style.display="none":gid("resize-handle").style.display="block")}))}function addResizeHandleEventListeners(){const e=gid("resize-handle"),t=gid("resize-handle-vertical"),i=gid("menu-container");function n(e){(e=e||window.event).preventDefault(),0==ui_vars.vertical_mode?ui_vars.resize_handle_current_x=e.clientX:ui_vars.resize_handle_current_y=e.clientY,document.onmouseup=l,document.onmousemove=s}function s(n){if((n=n||window.event).preventDefault(),0==ui_vars.vertical_mode){ui_vars.resize_handle_new_x=ui_vars.resize_handle_current_x-n.clientX,ui_vars.resize_handle_current_x=n.clientX;const t=(l=ui_vars.resize_handle_new_x,Math.min(Math.max(e.offsetLeft-l,350),gid("zoom-out-button").offsetLeft-40));e.style.left=t+"px",i.style.width=e.style.left}else{ui_vars.resize_handle_new_y=ui_vars.resize_handle_current_y-n.clientY,ui_vars.resize_handle_current_y=n.clientY;const e=(s=ui_vars.resize_handle_current_y,Math.max(Math.min(window.innerHeight,s),110));t.style.bottom=window.innerHeight-e+"px",i.style.top=e+"px",i.style.height=window.innerHeight-e+"px"}var s,l}function l(){document.onmouseup=null,document.onmousemove=null}e.addEventListener("dblclick",r_handle_reset),t.addEventListener("dblclick",r_handle_reset),e.onmousedown=n,t.onmousedown=n}function loadOSDData(){let e=[];for(let i=1,n=layout.total_stacks+1,s=0;i<n;i++){const n="dzi-files/STACK-"+i+"-FULL.jpg.dzi",l=t(i);e.push({tileSource:n,x:l.x,y:s,width:l.stack_width,layout:l}),s+=l.stack_height+layout.stack_y_spacer}function t(e){switch(e){case 1:return layout.stack_one;case 7:return layout.ephemera;case 8:return layout.therkelson;case 9:return layout.flat_file;default:return layout.standard}}viewer=OpenSeadragon({id:"osd-container",showNavigator:!1,showNavigationControl:!1,silenceMultiImageWarnings:!0,viewportMargins:{top:20,right:20,bottom:20,left:20},placeholderFillStyle:"#666",blendTime:.25,zoomPerClick:1,zoomPerScroll:1.4,tileSources:e})}function loadLibraryDataWithCallbacks(){let e=0;const t=["library_nested.json","periodicals.json","ia.json","special_collections.json","zones_subzones.json"];for(let e=0,n=t.length;e<n;e++)update_loading_screen_new("Fetching "+t[e]+"..."),fetch("./json-files/"+t[e]).then((e=>e.json())).then((s=>i(t[e],s,n)));function i(t,i,n){switch(update_loading_screen_new(t+" Loaded."),t){case"library_nested.json":stacks_data=i;break;case"periodicals.json":periodicals_data=i;break;case"special_collections.json":sc_data=i;break;case"ia.json":ia_data=i;break;case"zones_subzones.json":zones_data=i}e++,e==n&&(update_loading_screen_new("Populating sidebar lists..."),populateZonesSidebar(),populateSidebarLists("periodicals-list","p",periodicals_data,!1),populateSidebarLists("sc-list","c",sc_data,!1),populateSidebarLists("ia-list","i",ia_data,!0),addClickHandlers(),update_loading_screen_new("Sidebars completed."),gid("loadingStatus").style.opacity=0,gid("loadingStatus").style.visibility="hidden",gid("menu-container").style.opacity=1,gid("menu-container").style.visibility="visible",gid("resize-handle").style.opacity=1,gid("resize-handle").style.visibility="visible",gid("resize-handle-vertical").style.opacity=1,gid("resize-handle-vertical").style.visibility="visible")}}function populateSidebarLists(e,t,i,n){const s=new DocumentFragment;for(let e=0,l=i.length;e<l;e++)if(n){const t=buildIAListItem(i[e]);s.appendChild(t)}else{const n=quickNode("li",i[e].name);s.appendChild(n),n.setAttribute("id",t+"-"+e),n.setAttribute("onclick","hl(this);")}document.getElementById(e).appendChild(s)}function populateZonesSidebar(){const e=new DocumentFragment;for(let i=0,n=zones_data.length;i<n;i++){const s=zones_data[i],l=quickNodeTag("details"),a=quickNode("summary",s.name);if(e.appendChild(l),l.appendChild(a),a.setAttribute("id","z-"+i.toString()+"-summary"),a.setAttribute("onclick","hl(this);"),"Ephemera"!=s.name&&"Therkleson Collection"!=s.name&&"Flat File"!=s.name){const o=s.sub;for(let r=0,d=o.length;r<d;r++){const c=o[r],h=quickNodeTag("details"),u=quickNode("summary",c.name);if(u.setAttribute("id","s-"+i+"-"+r),u.setAttribute("onclick","hl(this);"),h.appendChild(u),l.appendChild(h),null!=c.p){const _=t("Periodicals (Shelves)",c.p,periodicals_data,"zp-");h.appendChild(_)}if(null!=c.c){const p=t("Sp. Collections (Shelves)",c.c,sc_data,"zc-");h.appendChild(p)}if(null!=c.i){const g=t("Scanned Items (Ext. Links)",c.i,ia_data,"zi-");h.appendChild(g)}}}function t(e,t,i,n){const s=quickNodeTag("details"),l=quickNode("summary",e),a=quickNodeTag("ul");s.appendChild(l),s.appendChild(a);for(let e=0,s=t.length;e<s;e++){const s=t[e],l=i[s].name;if("zi-"!=n){const e=quickNode("li",l);e.setAttribute("id",n+s),e.setAttribute("onclick","hl(this)"),a.appendChild(e)}else{const e=buildIAListItem(i[s]);a.appendChild(e)}}return s}}document.getElementById("zones-list").appendChild(e),update_loading_screen_new("Zones/Subzones completed.")}function zoomOut(){viewer.viewport.goHome()}function addClickHandlers(){viewer.addHandler("canvas-click",(function(e){if(e.quick){var t=getLocationFromViewportPoint(viewer.viewport.pointFromPixel(e.position));if(0!=t){drawClickShelfHighlight([t.stack,t.bank,t.row]);showClickInfo(t,stacks_data[t.stack-1][t.bank-1][t.row-1])}}})),viewer.addHandler("canvas-double-click",(function(e){viewer.viewport.panTo(viewer.viewport.pointFromPixel(e.position)),viewer.viewport.zoomBy(3)}))}function getLocationFromViewportPoint(e){const t=function(e){for(let t=0;t<layout.total_stacks;t++){const i=viewer.tileSources[t];if(e.y>i.y&&e.y<i.y+i.layout.stack_height)return t+1}return!1}(e);if(0==t)return l("stack"),!1;const i=viewer.tileSources[t-1].layout,n=function(e,t){if(e.x<t.x||e.x>t.x+t.stack_width)return!1;if(void 0!==t.uniform_bank_width)return Math.floor((e.x-t.x)/t.uniform_bank_width)+1;{let i=t.x;for(let n=0,s=t.bank_widths.length;n<s;n++){if(e.x>i&&e.x<i+t.bank_widths[n])return n+1;i+=t.bank_widths[n]}return!1}}(e,i);if(0==n)return l("bank"),!1;const s=function(e,t,i,n,s){const l=function(e,t,i){return void 0!==e.multiple_shelf_heights&&void 0!==e.multiple_shelf_heights[t]&&void 0!==e.multiple_shelf_heights[t][i]?e.multiple_shelf_heights[t][i]:e.shelf_heights}(t,n,s);let a=i+t.stack_height;for(let t=0,i=l.length;t<i;t++)if(a-=l[t],e.y>a)return t+1;return!1}(e,i,viewer.tileSources[t-1].y,t,n);return 0==s?(l("row"),!1):{stack:t,bank:n,row:s};function l(e){}}function showClickInfo(e,t){const i=new DocumentFragment;try{const e=t.zones[0][0],s=t.zones[0][1],l=quickNode("h4","ZONE:"),a=quickNode("p",zones_data[e].name);if(i.appendChild(l),i.appendChild(a),e<15){const t=quickNode("h4","SUBZONE:"),n=quickNode("p",zones_data[e].sub[s].name);i.appendChild(t),i.appendChild(n)}if(t.zones.length>1){const e=quickNode("h4","OTHER MATERIAL HERE:"),n=quickNodeTag("ul");for(let e=1,i=t.zones.length;e<i;e++){const i=t.zones[e],s=quickNode("li",zones_data[i[0]].name+" >> "+zones_data[i[0]].sub[i[1]].name);n.appendChild(s)}i.appendChild(e),i.appendChild(n)}null!=t.p&&n("PERIODICALS (SHELF):",t.p,periodicals_data),null!=t.c&&n("COLLECTIONS (SHELF):",t.c,sc_data),clicked_ia_indexes=function(e){let t=new Set;for(let i=0,n=e.length;i<n;i++){const n=e[i][0],s=e[i][1],l=zones_data[n].sub[s];if(l.hasOwnProperty("i"))for(let e=0,i=l.i.length;e<i;e++)t.add(l.i[e])}return 0!=t.size&&Array.from(t).sort()}(t.zones),0!=clicked_ia_indexes&&function(e,t,n){const s=quickNode("h4",e),l=quickNodeTag("ul");for(let e=0,i=t.length;e<i;e++)l.appendChild(buildIAListItem(n[t[e]]));i.appendChild(s),i.appendChild(l)}("SCANNED ITEMS (EXT. LINKS):",clicked_ia_indexes,ia_data)}catch(e){i.appendChild(quickNode("h4","WHOOPS! DATA ERROR :P")),i.appendChild(quickNode("p","The site's still working fine, just click on a different shelf. Sorry, my bad!! --Devin "))}function n(e,t,n){let s=[t.length];for(let e=0,i=t.length;e<i;e++)s[e]=n[t[e]].name;const l=function(e,t){const i=quickNode("h4",e),n=quickNodeTag("ul");for(let e=0,i=t.length;e<i;e++)n.appendChild(quickNode("li",t[e]));return[i,n]}(e,s);i.appendChild(l[0]),i.appendChild(l[1])}document.getElementById("clicked-info").replaceChildren(i)}async function retriggerAnimation(e,t){const i=gid(e);var n;i.classList.remove(t),await(n=1,new Promise((e=>setTimeout(e,n)))),i.classList.add(t)}function drawClickShelfHighlight(e){0==ui_vars.list_view&&retriggerAnimation("menu-div","click_h2_animation");const t=calcViewerHighlight(e,!1),i=gid("click_shelf_hl");null!=i&&viewer.removeOverlay(i);const n=document.createElement("div");n.id="click_shelf_hl",viewer.addOverlay({element:n,location:new OpenSeadragon.Rect(t.x,t.y,t.width,t.height)})}function clearAllHighlights(){viewer.clearOverlays();const e=Array.from(document.querySelectorAll(".text-hl1,.text-hl2"));for(let t=0,i=e.length;t<i;t++)e[t].classList.remove("text-hl1","text-hl2")}function hl(e){if(e.classList.contains("text-hl1")||e.classList.contains("text-hl2")){e.classList.remove("text-hl1","text-hl2"),clearSelectedHighlights(e.id);const t=e.id.split("-")[0];"z"!=t&&"s"!=t||clearAndCloseNestedElements(e,!0)}else processElementForHighlighting(e)}function clearSelectedHighlights(e){const t=Array.from(document.getElementsByClassName(e));for(let e=0,i=t.length;e<i;e++)viewer.removeOverlay(t[e])}function closeNested(e,t){e.parentNode.open&&clearAndCloseNestedElements(e,t)}function clearAndCloseNestedElements(e,t){const i=Array.from(e.parentNode.querySelectorAll(".text-hl1,.text-hl2"));for(let e=0,t=i.length;e<t;e++)i[e].classList.remove("text-hl1","text-hl2"),clearSelectedHighlights(i[e].id);if(null!=t){const t=Array.from(e.parentNode.getElementsByTagName("details"));for(let e=0,i=t.length;e<i;e++)t[e].removeAttribute("open")}}function processElementForHighlighting(e){let t=[];const i=e.id.split("-"),n=i[0],s=parseInt(i[1]);switch(n){case"z":zoomOut(),e.classList.add("text-hl1");const n=zones_data[s];let l=new Set;for(let e=0,t=n.sub.length;e<t;e++)n.sub[e].locs.forEach((e=>l.add([e[0],e[1],[0]])));t=Array.from(l);break;case"s":zoomOut(),e.classList.add("text-hl1"),subzone_index=parseInt(i[2]),t=zones_data[s].sub[subzone_index].locs;break;case"zp":e.classList.add("text-hl2"),t=periodicals_data[s].locs;break;case"zc":e.classList.add("text-hl2"),t=sc_data[s].locs;break;case"p":zoomOut(),e.classList.add("text-hl1"),t=periodicals_data[s].locs;break;case"c":zoomOut(),e.classList.add("text-hl1"),t=sc_data[s].locs}drawHighlights(n,t,e.id)}function drawHighlights(e,t,i){for(let n=0,s=t.length;n<s;n++){const s=t[n];is_zone="z"==e,viewer_pos=calcViewerHighlight(s,is_zone);let l=document.createElement("div");switch(e){case"z":l.classList.add("zone-top-hl",i);break;case"zp":case"zc":l.classList.add("hl2",i),viewer_pos.x+=2,viewer_pos.y+=2,viewer_pos.width-=4,viewer_pos.height-=4;break;default:l.classList.add("hl",i)}viewer.addOverlay({element:l,location:new OpenSeadragon.Rect(viewer_pos.x,viewer_pos.y,viewer_pos.width,viewer_pos.height)})}}function calcViewerHighlight(e,t){const i=viewer.tileSources[e[0]-1].layout;let n=getHighlightXComponents(e,i),s=getHighlightYComponents(e,i,t);return{x:n.x,y:s.y,width:n.width,height:s.height-4}}function getHighlightXComponents(e,t){return void 0!==t.uniform_bank_width?{x:t.uniform_bank_width*(e[1]-1)+t.x,width:t.uniform_bank_width}:{x:function(e,t){let i=0;for(let n=0;n<e;n++)i+=t[n];return i}(e[1]-1,t.bank_widths)+t.x,width:t.bank_widths[e[1]-1]}}function getHighlightYComponents(e,t,i){const n=function(e,t){return void 0!==t.multiple_shelf_heights&&void 0!==t.multiple_shelf_heights[e[0]]&&void 0!==t.multiple_shelf_heights[e[0]][e[1]]?t.multiple_shelf_heights[e[0]][e[1]]:t.shelf_heights}(e,t);let s=0;for(let t=0,i=e[0]-1;t<i;t++)s+=viewer.tileSources[t].layout.stack_height+layout.stack_y_spacer;return i?(s-=layout.zone_highlight_offset,{y:s,height:0}):(s+=t.stack_height,s-=function(e,t){let i=0;for(let n=0;n<t;n++)i+=e[n];return i}(n,e[2]),{y:s,height:n[e[2]-1]})}function gid(e){return document.getElementById(e)}function pad(e,t){for(e=e.toString();e.length<t;)e="0"+e;return e}function quickNodeTag(e){return document.createElement(e)}function quickNode(e,t){const i=document.createElement(e);return i.textContent=t,i}function update_loading_screen_new(e){gid("loadingUL").appendChild(quickNode("li",e))}function openMenu(){gid("menu-div").style.display="block",gid("clicked-div").open=!0,gid("show-menu-button").style.display="none"}function closeAllDetails(){const e=Array.from(document.querySelectorAll("details"));for(let t=0,i=e.length;t<i;t++)e[t].removeAttribute("open");clearAllHighlights()}function buildIAListItem(e){const t=document.createElement("li"),i=document.createElement("a");if(i.innerHTML=e.name,""!=e.date&&(i.innerHTML+=" ("+e.date+") "),"!"==e.url.charAt(0)?(i.href="https://archive.org/details/prelinger_library?tab=collection&query="+e.url.substring(1),i.innerHTML+="<span class=c>&#9903;</span> "):i.href="https://archive.org/details/"+e.url+"/mode/thumb?view=theater",e.hasOwnProperty("g")&&(i.innerHTML+="<span class=g>&#9881;</span> "),e.hasOwnProperty("il")){let t="<span class=il>";for(let i=0;i<e.il;i++)t+="&#9830;";t+="</span>",i.innerHTML+=t}return i.setAttribute("target","_blank"),t.appendChild(i),t}function toggleMenu(){const e=gid("menu-container"),t=gid("show-menu-button");if(0==ui_vars.vertical_mode){const i=gid("resize-handle");ui_vars.menu_open?(e.style.display="none",i.style.display="none",t.style.display="block"):(e.style.display="block",i.style.display="block",t.style.display="none")}else{const i=gid("resize-handle-vertical");ui_vars.menu_open?(e.style.display="none",i.style.display="none",t.style.display="block"):(e.style.display="block",i.style.display="block",t.style.display="none")}ui_vars.menu_open=!ui_vars.menu_open}function toggleListView(){const e=gid("clicked-div"),t=["zones-div","periodicals-div","sc-div","ia-div"],i=gid("list-view-button");if(ui_vars.list_view){e.style.display="block";for(let e=0,i=t.length;e<i;e++){gid(t[e]).style.display="none"}i.innerText="SHOW LISTS"}else{e.style.display="none";for(let e=0,i=t.length;e<i;e++){gid(t[e]).style.display="block"}i.innerText="SHOW CLICKED"}ui_vars.list_view=!ui_vars.list_view}function r_handle_reset(){const e=gid("resize-handle"),t=gid("resize-handle-vertical"),i=gid("menu-container");0==ui_vars.vertical_mode?(e.style.left="20em",i.style.width="20em"):(i.style.top="60vh",i.style.height="40vh",t.style.bottom="40vh")}function randomBackgroundGradient(){function e(){let e="";for(let t=0;t<6;t++)e+="0123456789abcdef".charAt(Math.floor(15*Math.random()));return e}Math.floor(360*Math.random());const t="linear-gradient(#"+e()+", #"+e()+")";document.body.style.background=t}loadLibraryDataWithCallbacks(),loadOSDData(),addWindowResizeEventListeners(),addResizeHandleEventListeners();